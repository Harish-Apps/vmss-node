$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
type: command
display_name: distilgpt2-finetune
experiment_name: llm-demo

# run in curated PyTorch CPU environment
environment: azureml:AzureML-pytorch-2.2-ubuntu20.04-py311-cpu@latest

# set your compute (Terraform output)
compute: azureml:llmdemo-dev-cpucc

# your code root
code: ..

command: >
  python src/train.py
  --model_name distilgpt2
  --epochs 1
  --batch_size 8
  --lr 5e-5

resources:
  instance_count: 1

# optional: enable DDP by uncommenting and scaling instance_count & max_nodes
# distribution:
#   type: pytorch
#   process_count_per_instance: 1
